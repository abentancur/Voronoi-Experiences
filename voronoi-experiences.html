<!DOCTYPE HTML>
<html>
    <head>
        <style>
            body {
                margin: 0px;
                padding: 0px;
            }
        </style>
    </head>
    <body>
        <div id="container"> </div>

        <script src="http://www.html5canvastutorials.com/libraries/three.min.js"></script>
        <script defer="defer">

            document.addEventListener('mousedown', onDocumentMouseDown, false);
            document.addEventListener("keydown", onDocumentKeyPress, false);
            //var ctx = c.getContext("2d");
            var points = []
            var locSpheres = []
            // revolutions per second
            var pathtype = "circle";
            var angularSpeed = 2; 
            var lastTime = 0;
            var starttimes = [];
            var pathtypes = [];
            var cyls = [];
            // this function is executed on each animation frame
            function animate(){
                // update
                var timer = new Date().getTime() * 0.0005;
                if (cyls.length > 0)
                {
                    for (i = 0; i < cyls.length; i++)
                    {
                        var cyl1 = cyls[i];
                        var s = locSpheres[i];
                        radius = 50;
                        speed = 5;
                        if(pathtypes[i] === "circle"){
                            cyl1.position.x = points[i][0] + Math.cos( starttimes[i]+timer*speed )*radius;
                            cyl1.position.y = points[i][1] + Math.sin( starttimes[i]+timer*speed )*radius;
                            s.position.x = cyl1.position.x;
                            s.position.y = cyl1.position.y;
                        }
                        else if(pathtypes[i] === "hline"){
                            cyl1.position.x = points[i][0] + Math.cos( starttimes[i]+timer*speed )*radius;
                            s.position.x = cyl1.position.x;
                        }
                        else if(pathtypes[i] === "vline"){
                            cyl1.position.y = points[i][1] + Math.sin( starttimes[i]+timer*speed )*radius;
                            s.position.y = cyl1.position.y;
                        }
                    }
                }

                // render
                renderer.render(scene, camera);

                // request new frame
                requestAnimationFrame(function(){
                    animate();
                });
            }

            // renderer
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // camera
            var camera = new THREE.OrthographicCamera(0, window.innerWidth, window.innerHeight, 0, 1, 1000);
            camera.position.z = 700;

            // scene
            var scene = new THREE.Scene();


            // start animation
            animate();

            function onDocumentMouseDown(event) {
                var geometry = new THREE.SphereGeometry( 3, 32, 32 );
                var material = new THREE.MeshBasicMaterial( {color: 0x000000} );
                var sphere = new THREE.Mesh( geometry, material );
                scene.add( sphere );
                sphere.position.x = event.clientX;
                sphere.position.y = window.innerHeight - event.clientY;
                sphere.position.z = 198;
                //http://www.paulirish.com/2009/random-hex-color-code-snippets/
                var mat = new THREE.MeshBasicMaterial({color: '#'+Math.floor(Math.random()*16777215).toString(16)});
                var cyl = new THREE.Mesh(new THREE.CylinderGeometry(0, 1400, 400, 50, 50, false), mat);
                cyl.rotation.x += Math.PI/2;
                cyl.position.x = event.clientX;
                cyl.position.y = window.innerHeight - event.clientY;
                points.push([event.clientX,window.innerHeight - event.clientY])
                cyl.overdraw = true;
                cyls.push(cyl);
                locSpheres.push(sphere);
                starttimes.push((new Date()).getTime());
                pathtypes.push(pathtype);
                scene.add(cyl);
                //document.getElementById("container").innerHTML = points;
            }

            function onDocumentKeyPress(event) {
                var k = event.which || event.keyCode;
                if(k == 67){
                    pathtype="circle";
                }
                else if(k == 72){
                    pathtype="hline";
                }
                else if(k == 86){
                    pathtype="vline";
                }
                else{
                    alert("Invalid Key!!!\n\nMouseDown to add new particles to the canvus\nPress 'c' to change subsequent particle paths to circles\nPress 'h' to change subsequent particle paths to horizontal lines\nPress 'v' to change subsequent particle paths to vertical lines"); 
                }
            }
        </script>
    </body>
</html>      
